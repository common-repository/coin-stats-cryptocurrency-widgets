"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}(function(){var APP_URL="https://api.coin-stats.com";var Marquee=function(){function Marquee(widgetPlaceHolder,currencies){_classCallCheck(this,Marquee);this.widgetPlaceHolder=widgetPlaceHolder;this.currencies=currencies;this.colors={background:widgetPlaceHolder.getAttribute("background"),statusUp:widgetPlaceHolder.getAttribute("status-up-color"),statusDown:widgetPlaceHolder.getAttribute("status-down-color"),text:widgetPlaceHolder.getAttribute("text-color"),buttons:widgetPlaceHolder.getAttribute("buttons-color"),border:widgetPlaceHolder.getAttribute("border-color")};this.disableCredits=widgetPlaceHolder.getAttribute("disable-credits");this.locale=widgetPlaceHolder.getAttribute("locale");this.currency=widgetPlaceHolder.getAttribute("currency");this.position=widgetPlaceHolder.getAttribute("position");this.width=widgetPlaceHolder.getAttribute("width");this.coinsCount=widgetPlaceHolder.getAttribute("coins-count");this.font=widgetPlaceHolder.getAttribute("font")||"Roboto, Arial, Helvetica";this.leftButtonMargin=0;this.showRightButton=true}_createClass(Marquee,[{key:"init",value:function init(){var _this=this;this.getData().then(function(res){_this.coinsData=res.coins;_this.clearWidgetPlaceHolder();_this.createRootContainer();_this.resetStyles()})}},{key:"getData",value:function getData(){return fetch(APP_URL+"/v2/coins?&limit="+this.coinsCount).then(function(res){return res.json()})}},{key:"clearWidgetPlaceHolder",value:function clearWidgetPlaceHolder(){var _this2=this;this.widgetPlaceHolder.childNodes.forEach(function(node){_this2.widgetPlaceHolder.removeChild(node)})}},{key:"createRootContainer",value:function createRootContainer(){this.clearWidgetPlaceHolder();var rootContainer=document.createElement("div");var rootStyles="\n        z-index: 1000;\n        color: "+this.colors.text+";\n        font-family: "+this.font+", sans-serif;\n        -webkit-touch-callout: none;\n        -webkit-user-select: none;\n        -khtml-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none; \n        user-select: none;\n        "+(this.position==="static"?"max-width: "+this.width+";":"")+"\n      ";var splitedPosition=this.position.split("-");if(splitedPosition[0]==="fixed"){rootStyles+="\n          position: fixed;\n          width: 100%;\n          left: 0;\n          "+splitedPosition[1]+": 0;\n        "}else if(this.position==="static"){rootStyles+="\n          position: static;\n        "}rootContainer.style.cssText=rootStyles;rootContainer.appendChild(this.createContentContainer(splitedPosition[0]==="fixed"));this.widgetPlaceHolder.appendChild(rootContainer)}},{key:"resetStyles",value:function resetStyles(){this.widgetPlaceHolder.insertAdjacentHTML("beforeend","<style>\n        coin-stats-marquee-widget * {\n          word-break: initial;\n          word-wrap: initial;\n          box-sizing: border-box;\n        }\n      </style>")}},{key:"createContentContainer",value:function createContentContainer(isFixed){var contentContainer=document.createElement("div");contentContainer.style.cssText="\n        width: 100%;\n        "+(isFixed?"":"border-radius: 29px;")+"\n        "+(isFixed?"":"border: solid 1px "+this.colors.border+";")+"\n        background: "+this.colors.background+";\n        padding: 20px;\n        display: flex;\n        font-size: 16px;\n        font-weight: 300;\n        font-stretch: normal;\n        font-style: normal;\n        line-height: normal;\n        letter-spacing: normal;\n      ";contentContainer.appendChild(this.createCoinsListSection());contentContainer.appendChild(this.createNavigationSection());return contentContainer}},{key:"createCoinsListSection",value:function createCoinsListSection(){var _this3=this;var coinsListBlock=document.createElement("div");var coinsUnorderedList=document.createElement("ul");coinsListBlock.style.cssText="\n        overflow: hidden;\n        width: 100%;\n      ";coinsUnorderedList.style.cssText="\n        display: flex;\n        transition: margin 0.3s;\n        padding: 0;\n        margin: 0;\n        list-style-type: none;\n      ";coinsUnorderedList.className="cs-coins-unordered-list";this.coinsData.forEach(function(coin){coinsUnorderedList.appendChild(_this3.createCoinList(coin))});!this.disableCredits&&coinsUnorderedList.appendChild(this.createCredits());coinsListBlock.appendChild(coinsUnorderedList);return coinsListBlock}},{key:"createCredits",value:function createCredits(){var creditsContainer=document.createElement("li");var creditsTopBlock=document.createElement("div");var creditsBotBlock=document.createElement("div");creditsContainer.addEventListener("click",function(){window.open("http://coinstats.app")});creditsTopBlock.innerHTML="Powered by";creditsBotBlock.innerHTML="Coin<b>Stats</b>";creditsTopBlock.style="white-space: nowrap;";creditsContainer.style.cssText="\n        align-items: center;\n        cursor: pointer;\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n    ";creditsContainer.appendChild(creditsTopBlock);creditsContainer.appendChild(creditsBotBlock);return creditsContainer}},{key:"createCoinList",value:function createCoinList(coin){var coinsList=document.createElement("li");coinsList.style.cssText="\n        display: flex;\n        margin-right: 42px;\n        align-items: center;\n        cursor: pointer;\n      ";coinsList.addEventListener("click",function(){window.open("https://coinstats.app/en/coins/"+coin.i)});coinsList.appendChild(this.createCoinListFistColumn(coin));coinsList.appendChild(this.createCoinListSecondColumn(coin));return coinsList}},{key:"createCoinListFistColumn",value:function createCoinListFistColumn(coin){var firstColumnBlock=document.createElement("div");firstColumnBlock.style.cssText="\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n        height: 100%;\n      ";firstColumnBlock.appendChild(this.createCoinLogo(coin.ic));firstColumnBlock.appendChild(this.createPercentArrow(coin.p24));return firstColumnBlock}},{key:"createCoinLogo",value:function createCoinLogo(src){var logoBlock=document.createElement("div");var logo=document.createElement("img");logo.style.width="23px";logo.src=this.iconSrcMaker(src);logoBlock.appendChild(logo);return logoBlock}},{key:"createPercentArrow",value:function createPercentArrow(p24){var percentArrowBlock=document.createElement("div");percentArrowBlock.style.cssText="\n        width: 20px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      ";percentArrowBlock.innerHTML='\n        <svg style="'+("width: 16px; height: 16px; margin-top: 3px; \n        "+(p24<0?" transform: rotate(180deg);":"")+"\n        ")+'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">\n          <path fill="'+(p24<0?this.colors.statusDown:this.colors.statusUp)+'" fill-rule="evenodd" d="M8.894 5.789l2.382 4.764A1 1 0 0 1 10.382 12H5.618a1 1 0 0 1-.894-1.447l2.382-4.764a1 1 0 0 1 1.788 0z"/>\n        </svg>\n      ';return percentArrowBlock}},{key:"iconSrcMaker",value:function iconSrcMaker(icon){if(!icon){return""}if(icon.toLowerCase().includes("http")){return icon}return APP_URL+"/api/files/812fde17aea65fbb9f1fd8a478547bde/"+icon}},{key:"createCoinListSecondColumn",value:function createCoinListSecondColumn(coin){var secondColumnBlock=document.createElement("div");var nameBlock=document.createElement("span");var priceContainer=document.createElement("div");var percantageBlock=document.createElement("span");var priceValueBlock=document.createElement("span");secondColumnBlock.style.cssText="\n        margin-left: 11px;\n        height: 100%;\n        padding-top: 3px;\n        display: flex;\n        justify-content: space-between;\n        flex-direction: column;\n      ";nameBlock.style.cssText="\n        white-space: nowrap;\n        text-align: left;\n      ";priceContainer.style.cssText="\n        display: flex;\n        flex-direction: row;\n        margin-top: 5px;\n      ";percantageBlock.style.color=coin.p24<0?this.colors.statusDown:this.colors.statusUp;nameBlock.innerHTML=coin.n;secondColumnBlock.appendChild(nameBlock);percantageBlock.style.paddingRight="8px";percantageBlock.innerHTML=Math.abs(coin.p24)+"%";priceValueBlock.innerHTML=this.formatPrice(coin.pu);priceContainer.appendChild(percantageBlock);priceContainer.appendChild(priceValueBlock);secondColumnBlock.appendChild(priceContainer);return secondColumnBlock}},{key:"formatPrice",value:function formatPrice(price){var maximumFractionDigits=6;var locale=this.locale;if(price>1){maximumFractionDigits=2}if(!this.locale&&navigator){locale=navigator.language}var calculatedPrice=void 0;if(this.currency!=="USD"){calculatedPrice=price*this.currencies[this.currency].rate}var formattedPrice=new Intl.NumberFormat(locale,{maximumFractionDigits:maximumFractionDigits}).format(calculatedPrice||price);return this.currencies[this.currency].symbol+formattedPrice}},{key:"createNavigationSection",value:function createNavigationSection(){var navigationContainer=document.createElement("div");navigationContainer.style.cssText="\n        display: flex;\n        align-items: center;\n        padding-left: 10px;\n      ";navigationContainer.appendChild(this.createNavigationButton("left"));navigationContainer.appendChild(this.createNavigationButton("right"));return navigationContainer}},{key:"createNavigationButton",value:function createNavigationButton(side){var _this4=this;var buttonBlock=document.createElement("div");var data=void 0;var style="";if(side==="right"){data=this.showRightButton;buttonBlock.addEventListener("click",function(){return _this4.handleRightButtonClick(_this4.widgetPlaceHolder)})}else{style='style="transform: rotate(180deg)"';data=this.leftButtonMargin;buttonBlock.addEventListener("click",function(){return _this4.handleLeftButtonClick(_this4.widgetPlaceHolder)})}buttonBlock.innerHTML='\n        <svg\n          width="8"\n          height="14"\n          view-box="0 0 8 14"\n          fill="none"\n          xmlns="http://www.w3.org/2000/svg"\n          '+style+'\n        >\n          <path\n            fill-rule="evenodd"\n            clip-rule="evenodd"\n            d="M8.0005 7.0005C8.0005 6.7455 7.9025 6.4895 7.7075 6.2945L1.7055 0.2925C1.3155 -0.0975 0.6835 -0.0975 0.2925 0.2925C-0.0975 0.6835 -0.0975 1.3145 0.2925 1.7055L5.5895 7.0005L0.2925 12.2965C-0.0975 12.6865 -0.0975 13.3175 0.2925 13.7085C0.6835 14.0985 1.3155 14.0985 1.7055 13.7085L7.7075 7.7065C7.9025 7.5115 8.0005 7.2555 8.0005 7.0005Z"\n            transform="translate(-0.000488281 -0.000488281)"\n            fill="'+this.colors.buttons+'"\n            fill-opacity='+(data?"0.5":"0.18")+'\n            class="cs-'+side+'-nav-button"\n          />\n        </svg>\n      ';buttonBlock.style.cssText="\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 28px;\n        height: 28px;\n      ";return buttonBlock}},{key:"handleLeftButtonClick",value:function handleLeftButtonClick(widgetPlaceHolder){if(this.leftButtonMargin===0){return}var unorderedListBlock=widgetPlaceHolder.querySelector(".cs-coins-unordered-list");var containerVisibleWidth=unorderedListBlock.offsetWidth+this.leftButtonMargin;var position=this.leftButtonMargin+containerVisibleWidth;if(position>0){this.leftButtonMargin=0;this.showRightButton=true}else{this.leftButtonMargin+=containerVisibleWidth;this.showRightButton=true}unorderedListBlock.style.marginLeft=this.leftButtonMargin+"px";widgetPlaceHolder.querySelector(".cs-left-nav-button").style="fill-opacity: "+(this.leftButtonMargin?"0.5":"0.18")+";";widgetPlaceHolder.querySelector(".cs-right-nav-button").style="fill-opacity: "+(this.showRightButton?"0.5":"0.18")+";"}},{key:"handleRightButtonClick",value:function handleRightButtonClick(widgetPlaceHolder){var unorderedListBlock=widgetPlaceHolder.querySelector(".cs-coins-unordered-list");var containerVisibleWidth=unorderedListBlock.offsetWidth+this.leftButtonMargin;var containerHiddenWidth=containerVisibleWidth-unorderedListBlock.scrollWidth;var childNodes=unorderedListBlock.childNodes;var i=0;var wi=0;var position=0;while(position===0&&i<=childNodes.length){if(wi+childNodes[i].offsetWidth>containerVisibleWidth){position=this.leftButtonMargin-wi}wi+=childNodes[i].offsetWidth+40;++i}if(position<containerHiddenWidth){this.leftButtonMargin=containerHiddenWidth;this.showRightButton=false;widgetPlaceHolder.querySelector(".cs-right-nav-button").style="fill-opacity: "+(this.showRightButton?"0.5":"0.18")+";"}else{this.leftButtonMargin=position}unorderedListBlock.style.marginLeft=this.leftButtonMargin+"px";widgetPlaceHolder.querySelector(".cs-left-nav-button").style="fill-opacity: "+(this.leftButtonMargin?"0.5":"0.18")+";"}}]);return Marquee}();function observeMutations(nodes,currencies){var observer=new MutationObserver(callback);nodes.forEach(function(node){var disable=node.getAttribute("disable-mutation-observer");if(!disable){observer.observe(node,{attributes:true})}});function callback(MutationRecord){new Marquee(MutationRecord[0].target,currencies).init()}}function getCurrencies(){return fetch(APP_URL+"/v3/currencies").then(function(resFiats){return resFiats.json()})}var allPlaceHolders=document.querySelectorAll("coin-stats-marquee-widget");getCurrencies().then(function(currencies){allPlaceHolders.forEach(function(node){observeMutations(allPlaceHolders,currencies);new Marquee(node,currencies).init()})})})();